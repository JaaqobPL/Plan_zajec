<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√≥j Plan Zajƒôƒá</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Space Grotesk', sans-serif; background: #e0e0e0; margin: 0; display: flex; justify-content: center; }
  .app { width: 100%; max-width: 400px; background: white; min-height: 100vh; padding: 20px; box-sizing: border-box; }
  
  .header { background: rgba(165,165,165,0.2); border-radius: 12px; padding: 10px 5px; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between; }
  .text-center { text-align: center; flex-grow: 1; }
  .title { font-size: 26px; margin: 0; color: #000; }
  .date { font-size: 15px; color: #333; margin-top: 4px; font-weight: bold; }
  .week { font-size: 13px; color: #666; margin-top: 4px; }
  
  .btn { background: none; border: none; font-size: 22px; cursor: pointer; padding: 10px 15px; border-radius: 8px; }
  .btn:hover { background: rgba(0,0,0,0.1); }
  
  .card { border-radius: 16px; padding: 12px 16px; margin-bottom: 12px; display: flex; flex-direction: column; color: white; text-decoration: none; }
  .card.active { outline: 4px solid #2e7d32; box-shadow: 0 0 20px rgba(46,125,50,0.6); transform: scale(1.02); }
  .przedmiot { text-align: center; font-size: 28px; line-height: 1.2; font-weight: bold; }
  .wykladowca { text-align: center; font-size: 16px; opacity: 0.9; margin: 4px 0 16px; }
  .row { display: flex; justify-content: space-between; align-items: flex-end; }
  .godzina { font-size: 21px; }
  .sala { font-size: 31px; line-height: 0.9; }
  
  .okienko { text-align: center; padding: 10px; margin-bottom: 12px; background: rgba(0,0,0,0.03); border-radius: 8px; color: #555; font-size: 14px; font-weight: bold; border: 2px dashed #bbb; }
  .msg { text-align: center; font-size: 18px; color: #727272; margin-top: 50px; display: none; }
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <button class="btn" id="prev">‚ùÆ</button>
    <div class="text-center">
      <h1 class="title" id="tytul"></h1>
      <div class="date" id="data"></div>
      <div class="week" id="info"></div>
    </div>
    <button class="btn" id="next">‚ùØ</button>
  </div>
  <div id="plan-container"></div>
  <div id="komunikat" class="msg"></div>
</div>

<script>
  let baza = null; 
  let dataWysw = new Date();
  
  const nazwyDni = ["Niedziela", "Poniedzia≈Çek", "Wtorek", "≈öroda", "Czwartek", "PiƒÖtek", "Sobota"];
  const miesiace = ["stycznia", "lutego", "marca", "kwietnia", "maja", "czerwca", "lipca", "sierpnia", "wrze≈õnia", "pa≈∫dziernika", "listopada", "grudnia"];
  
  // tablica tygodni (dni od poniedzia≈Çku do piƒÖtku)
  const kalendarzMap = {};
  [
    ["02.03","03.03","04.03","05.03","06.03"], ["09.03","10.03","11.03","12.03","13.03"],
    ["16.03","17.03","18.03","19.03","20.03"], ["23.03","24.03","25.03","26.03","27.03"],
    ["30.03","07.04","08.04","31.03","01.04"], ["13.04","21.04","15.04","09.04","10.04"],
    ["20.04","28.04","22.04","16.04","17.04"], ["04.05","05.05","29.04","23.04","24.04"],
    ["11.05","12.05","06.05","30.04","27.04"], ["18.05","19.05","13.05","07.05","08.05"],
    ["25.05","26.05","20.05","14.05","15.05"], ["01.06","02.06","27.05","21.05","22.05"],
    ["08.06","09.06","03.06","28.05","29.05"], ["15.06","16.06","10.06","11.06","12.06"],
    ["22.06","23.06","17.06","18.06","19.06"]
  ].forEach((tydz, index) => {
    tydz.forEach((data, i) => kalendarzMap[data] = { dzienWPlanie: i + 1, tydzien: index + 1 });
  });

  kalendarzMap["27.02"] = { dzienWPlanie: 5, tydzien: 1 };

  // filtr tygodni
  function pasuje(zapis, aktTyg) {
    if (!zapis || zapis === "oba") return true;
    const z = zapis.toLowerCase();
    
    const liczby = z.match(/\d+(-\d+)?/g);
    if (liczby && !liczby.some(zakres => {
      const [start, end] = zakres.split('-').map(Number);
      return end ? (aktTyg >= start && aktTyg <= end) : (aktTyg === start);
    })) return false;
    
    if (z.includes("x1") && aktTyg % 2 === 0) return false;
    if (z.includes("x2") && aktTyg % 2 !== 0) return false;
    if ((z.includes("1 polowa") || z.includes("1 po≈Çowa")) && aktTyg > 8) return false;
    if ((z.includes("2 polowa") || z.includes("2 po≈Çowa")) && aktTyg < 9) return false;
    
    return true; 
  }

  // Nawigacja
  document.getElementById("prev").onclick = () => { dataWysw.setDate(dataWysw.getDate() - 1); render(); };
  document.getElementById("next").onclick = () => { dataWysw.setDate(dataWysw.getDate() + 1); render(); };

  async function start() {
    try {
      const res = await fetch('plan.json');
      baza = await res.json();
      render();
    } catch {
      const msg = document.getElementById("komunikat");
      msg.style.display = "block"; msg.innerText = "B≈ÇƒÖd pobierania planu.";
    }
  }

  function render() {
    if (!baza) return;
    const kontener = document.getElementById("plan-container");
    const msg = document.getElementById("komunikat");
    kontener.innerHTML = ""; msg.style.display = "none";

    document.getElementById("data").innerText = `${dataWysw.getDate()} ${miesiace[dataWysw.getMonth()]} ${dataWysw.getFullYear()}`;
    const dzisiajStr = `${String(dataWysw.getDate()).padStart(2,'0')}.${String(dataWysw.getMonth()+1).padStart(2,'0')}`;
    const info = kalendarzMap[dzisiajStr];

    if (!info) {
      document.getElementById("tytul").innerText = nazwyDni[dataWysw.getDay()];
      document.getElementById("info").innerText = "Brak zajƒôƒá dydaktycznych";
      msg.style.display = "block"; msg.innerText = "Id≈∫ odpoczƒÖƒá, brak zajƒôƒá! üéâ"; return;
    }

    const prawdziweDzisiaj = new Date();
    const czyToDzisiaj = prawdziweDzisiaj.toDateString() === dataWysw.toDateString();
    const minutyTeraz = prawdziweDzisiaj.getHours() * 60 + prawdziweDzisiaj.getMinutes();

    const nazwaPrawdziwa = nazwyDni[dataWysw.getDay()];
    const nazwaZPlanu = nazwyDni[info.dzienWPlanie];
    document.getElementById("tytul").innerText = nazwaPrawdziwa !== nazwaZPlanu ? `${nazwaPrawdziwa} (jako: ${nazwaZPlanu})` : nazwaZPlanu;
    document.getElementById("info").innerText = `Tyg: ${info.tydzien}/15 (${info.tydzien % 2 === 0 ? "x2" : "x1"}, ${info.tydzien <= 8 ? "1 po≈Ç." : "2 po≈Ç."})`;

    let zajeciaDnia = baza.plan.filter(z => z.dzien === info.dzienWPlanie && pasuje(z.tygodnie, info.tydzien));
    if (!zajeciaDnia.length) { msg.style.display = "block"; msg.innerText = "Nie masz zajƒôƒá w ten dzie≈Ñ. Looz!"; return; }

    zajeciaDnia.sort((a, b) => (parseInt(a.od.split(":")[0])*60 + parseInt(a.od.split(":")[1])) - (parseInt(b.od.split(":")[0])*60 + parseInt(b.od.split(":")[1])));
    let koniecPoprzednich = null;

    zajeciaDnia.forEach(z => {
      const p = baza.przedmioty[z.id_przedmiotu];
      if (!p) return;

      const odMin = parseInt(z.od.split(":")[0])*60 + parseInt(z.od.split(":")[1]);
      const doMin = parseInt(z.do.split(":")[0])*60 + parseInt(z.do.split(":")[1]);

      if (koniecPoprzednich !== null && (odMin - koniecPoprzednich) > 15) {
        const przerwa = odMin - koniecPoprzednich;
        kontener.innerHTML += `<div class="okienko">‚òï Okienko: ${Math.floor(przerwa/60) ? Math.floor(przerwa/60)+'h ' : ''}${przerwa%60}min</div>`;
      }
      koniecPoprzednich = doMin;

      const el = document.createElement(p.link && p.link !== "#" ? "a" : "div");
      if (p.link && p.link !== "#") { el.href = p.link; el.target = "_blank"; }
      el.className = `card ${(czyToDzisiaj && minutyTeraz >= odMin && minutyTeraz <= doMin) ? "active" : ""}`;
      el.style.background = p.kolor || "#727272";
      el.innerHTML = `
        <div class="przedmiot">${p.nazwa}</div>
        <div class="wykladowca">${p.wykladowca}</div>
        <div class="row">
          <div class="godzina">${z.od.padStart(5, '0')} - ${z.do.padStart(5, '0')}</div>
          <div class="sala">${p.sala}</div>
        </div>`;
      kontener.appendChild(el);
    });
  }

  start();
  setInterval(() => { if (new Date().toDateString() === dataWysw.toDateString()) render(); }, 60000);
</script>
</body>
</html>
